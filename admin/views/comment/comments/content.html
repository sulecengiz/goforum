{{define "content"}}
{{template "alert" .Alert}}
<div class="container mt-4">
  <h2>Post Yorumları</h2>
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-1">#{{.Post.ID}} - {{.Post.Title}}</h5>
      <small class="text-muted">Oluşturulma: {{.Post.CreatedAt.Format "02.01.2006 15:04"}}</small>
      <div class="mt-2">
        <a href="/admin/comment/posts" class="btn btn-sm btn-outline-secondary"><i class="fa fa-arrow-left"></i> Geri</a>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-sm table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px;">ID</th>
          <th>Yorum</th>
          <th style="width:160px;">Kullanıcı/İsim</th>
          <th style="width:170px;">Tarih</th>
          <th style="width:120px;">İşlemler</th>
        </tr>
      </thead>
      <tbody>
      {{if .Comments}}
        {{range .Comments}}
          <tr>
            <td>#{{.ID}}</td>
            <td>
              <div style="margin-left: {{.IndentPx}}px;">
                {{if gt .Depth 0}}<span class="note-icon-arrow-circle-right me-1" title="Derinlik"></span>{{end}}
                {{.Short}}
                {{if .ParentID}}<small class="text-muted">(Yanıt: #{{.ParentID}})</small>{{end}}
              </div>
            </td>
            <td>{{if .Name}}{{.Name}}{{else}}(Anonim){{end}}</td>
            <td>{{.CreatedAt.Format "02.01.2006 15:04"}}</td>
            <td class="d-flex gap-1">
              <button type="button" class="btn btn-sm btn-outline-info view-comment"
                      data-bs-toggle="modal"
                      data-bs-target="#commentDetailModal"
                      data-id="{{.ID}}"
                      data-name="{{if .Name}}{{.Name}}{{else}}(Anonim){{end}}"
                      data-date="{{.CreatedAt.Format "02.01.2006 15:04"}}"
                      data-full="{{.Comment}}">
                <i class="fa fa-eye"></i>
              </button>
              <a class="btn btn-sm btn-outline-danger" onclick="return confirm('Silinsin mi?');" href="/admin/comment/delete/{{.ID}}" title="Sil">
                <i class="fa fa-trash"></i>
              </a>
            </td>
          </tr>
        {{end}}
      {{else}}
        <tr>
          <td colspan="5" class="text-center text-muted py-4">Bu posta ait yorum bulunmuyor.</td>
        </tr>
      {{end}}
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="commentDetailModal" tabindex="-1" aria-labelledby="commentDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="commentDetailLabel">Yorum Detayı</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <dl class="row mb-0">
          <dt class="col-sm-3">Yorum ID</dt>
          <dd class="col-sm-9" id="detail-id">-</dd>
          <dt class="col-sm-3">Kullanıcı</dt>
          <dd class="col-sm-9" id="detail-name">-</dd>
          <dt class="col-sm-3">Tarih</dt>
          <dd class="col-sm-9" id="detail-date">-</dd>
          <dt class="col-sm-3">Metin</dt>
          <dd class="col-sm-9"><pre id="detail-full" class="mb-0" style="white-space:pre-wrap;font-family:inherit;"></pre></dd>
        </dl>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  document.addEventListener('click', function(e){
    const btn = e.target.closest('.view-comment');
    if(!btn) return;
    const id = btn.getAttribute('data-id');
    const name = btn.getAttribute('data-name');
    const date = btn.getAttribute('data-date');
    const full = btn.getAttribute('data-full');
    document.getElementById('detail-id').textContent = '#'+id;
    document.getElementById('detail-name').textContent = name;
    document.getElementById('detail-date').textContent = date;
    document.getElementById('detail-full').textContent = full;
  });
})();
</script>
{{end}}
