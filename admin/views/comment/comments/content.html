{{ define "content" }}
{{template "alert" .Alert}}
<style>
    #modalMessageContent{
        word-break: break-word;
    }
    .message-cell{
        max-width: 300px;
        word-break: break-word;
    }
</style>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ .Post.Title }} - Yorumları</h2>
        <a href="/admin/comment/posts" class="btn btn-secondary">
            <i class="fa-solid fa-arrow-left"></i> Geri Dön
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>ID</th>
                <th>Ad Soyad</th>
                <th>Yorum</th>
                <th>Parent</th>
                <th>Tarih</th>
                <th>İşlemler</th>
            </tr>
            </thead>
            <tbody>
            {{ range $index, $value := .Comments }}
            <tr>
                <td>{{ $value.ID }}</td>
                <td>{{ $value.Name }}</td>
                <td class="message-cell" data-message="{{ $value.Comment }}">
                    {{ $value.Comment }}
                </td>
                <td>{{ if .ParentID }}{{ .ParentName }}{{ else }}-{{ end }}</td>
                <td>{{ $value.CreatedAt.Format "02.01.2006 15:04" }}</td>
                <td>
                    <button type="button" class="btn btn-outline-info btn-sm me-1"
                            data-bs-toggle="modal"
                            data-bs-target="#messageModal"
                            data-name="{{ $value.Name }}"
                            data-message="{{ $value.Comment }}">
                        <i class="fa-solid fa-eye"></i> Detay
                    </button>
                    <a href="/admin/comment/delete/{{ $value.ID }}"
                       class="btn btn-outline-danger btn-sm"
                       onclick="return confirm('Bu yorumu silmek istediğinizden emin misiniz?')">
                        <i class="fa-solid fa-trash"></i> Sil
                    </a>
                </td>
            </tr>
            {{ else }}
            <tr>
                <td colspan="6" class="text-center">Bu post için henüz yorum bulunmuyor.</td>
            </tr>
            {{ end }}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">Yorum Detayları</h5>

            </div>
            <div class="modal-body">
                <p><strong>Ad Soyad:</strong> <span id="modalNameContent"></span></p>
                <hr>
                <p><strong>Yorum:</strong></p>
                <div id="modalMessageContent" class="border p-3 bg-light rounded"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Sayfa yüklendiğinde çalışacak
    document.addEventListener('DOMContentLoaded', function () {
        // --- Tablo içindeki mesajları kısalt ---
        document.querySelectorAll('.message-cell').forEach(function (cell) {
            const fullMessage = cell.getAttribute('data-message');
            const words = fullMessage.split(" ");
            if (words.length > 5) {
                cell.textContent = words.slice(0, 5).join(" ") + "...";
            } else {
                cell.textContent = fullMessage;
            }
        });

        // --- Modal için ---
        let messageModal = document.getElementById('messageModal');
        messageModal.addEventListener('show.bs.modal', function (event) {
            let button = event.relatedTarget;

            // Butondaki tüm verileri al
            let name = button.getAttribute('data-name');
            let comment = button.getAttribute('data-message');

            // Modal içeriğini güncelle
            document.getElementById('modalNameContent').textContent = name;
            document.getElementById('modalMessageContent').textContent = comment;
        });
    });
</script>
{{ end }}