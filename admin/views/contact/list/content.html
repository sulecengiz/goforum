{{ define "content" }}
{{template "alert" .Alert}}
<div class="container mt-5">
    <h2>İletişim Kayıtları</h2>
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>Ad Soyad</th>
            <th>E-posta</th>
            <th>Telefon</th>
            <th>Mesaj</th>
            <th>Tarih</th>
            <th>İşlemler</th>
        </tr>
        </thead>
        <tbody>
        {{ range $index, $value := .Contacts }}
        <tr>
            <td>{{ $value.ID }}</td>
            <td>{{ $value.Name }}</td>
            <td>{{ $value.Email }}</td>
            <td>{{ $value.Phone }}</td>
            <!-- JS ile kısaltma için data-message attribute kullanalım -->
            <td class="message-cell" data-message="{{ $value.Message }}"></td>
            <td>{{ $value.CreatedAt }}</td>
            <td>
                <a href="/admin/contact/delete/{{$value.ID}}" class="btn btn-outline-danger">
                    <i class="fa fa-trash"></i>
                </a>
                <a href="#" class="btn btn-outline-primary"
                   data-bs-toggle="modal"
                   data-bs-target="#messageModal"
                   data-name="{{ $value.Name }}"
                   data-email="{{ $value.Email }}"
                   data-phone="{{ $value.Phone }}"
                   data-message="{{ $value.Message }}">
                    <i class="fa-solid fa-circle-info"></i>
                </a>
            </td>
        </tr>
        {{ else }}
        <tr>
            <td colspan="7">Hiç kayıt bulunamadı.</td>
        </tr>
        {{ end }}
        </tbody>
    </table>
</div>

<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">Mesaj Detayları</h5>
            </div>
            <div class="modal-body">
                <p><strong>Ad Soyad:</strong> <span id="modalNameContent"></span></p>
                <p><strong>E-posta:</strong> <span id="modalEmailContent"></span></p>
                <p><strong>Telefon:</strong> <span id="modalPhoneContent"></span></p>
                <hr>
                <p><strong>Mesaj:</strong> </p>
                <span id="modalMessageContent"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Sayfa yüklendiğinde çalışacak
    document.addEventListener('DOMContentLoaded', function () {
        // --- Tablo içindeki mesajları kısalt ---
        document.querySelectorAll('.message-cell').forEach(function (cell) {
            const fullMessage = cell.getAttribute('data-message');
            const words = fullMessage.split(" ");
            if (words.length > 3) {
                cell.textContent = words.slice(0, 3).join(" ") + "...";
            } else {
                cell.textContent = fullMessage;
            }
        });

        // --- Modal için ---
        let messageModal = document.getElementById('messageModal');
        messageModal.addEventListener('show.bs.modal', function (event) {
            let button = event.relatedTarget;

            // Butondaki tüm verileri al
            let name = button.getAttribute('data-name');
            let email = button.getAttribute('data-email');
            let phone = button.getAttribute('data-phone');
            let message = button.getAttribute('data-message');

            // Modal içeriğini güncelle
            document.getElementById('modalNameContent').textContent = name;
            document.getElementById('modalEmailContent').textContent = email;
            document.getElementById('modalPhoneContent').textContent = phone;
            document.getElementById('modalMessageContent').textContent = message;
        });
    });
</script>
{{ end }}
