{{ define "content" }}
<header class="masthead" style="background-image: url('/{{ .Post.Picture_url }}')">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="post-heading">
                    <h1>{{ .Post.Title }}</h1>
                    <h2 class="subheading">{{ .Post.Description }}</h2>
                </div>
            </div>
        </div>
    </div>
</header>

<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <!-- Blog İçerik -->
                <div id="blog-content" class="blog-content mb-5">{{ .Post.Content }}</div>

                <!-- Yorumlar -->
                <div class="comments-section">
                    <h3 class="mb-4">Yorumlar ({{ .TotalComments }})</h3>

                    <!-- Yorum Formu -->
                    <div class="comment-form-container mt-5">
                        {{ if .User }}
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4" id="form-title">Yorum Yap</h4>
                                <form id="comment-form" action="/yazilar/{{ .Post.Slug }}/yorum-ekle" method="POST">
                                    <input type="hidden" name="parent_id" id="parent-id-input">
                                    <div class="mb-3">

                                        <input type="text" class="form-control" id="name" name="name" value="{{ .User.Username }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="comment" class="form-label" style="font-size: smaller">Yorumunuz</label>
                                        <textarea class="form-control" id="comment" name="comment" rows="4" required></textarea>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <button type="submit" class="btn btn-primary">Gönder</button>
                                        <button type="button" id="cancel-reply" class="btn btn-primary" style="display: none;">
                                            Yanıtı İptal Et
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        {{ else }}
                        <div class="alert" style="background-color: rgba(138,109,59,0.83)">
                            Yorum yapabilmek için lütfen <a href="/login">giriş yapın</a> veya <a href="/register">kayıt olun</a>.
                        </div>
                        {{ end }}
                    </div>
                    <!-- Yorum Listesi -->
                    <div class="comment-list">
                        {{ if .Comments }}
                        {{ template "renderComment" .Comments }}
                        {{ else }}
                        <div class="alert" style="background-color: rgba(193,164,125,0.25); color: #49391e">Henüz yorum yapılmamış. İlk yorumu siz yapın!</div>
                        {{ end }}
                    </div>
                </div> <!-- comments-section -->
            </div>
        </div>
    </div>
</article>
<!-- Yukarı Çık Butonu -->
<button id="back-to-top" class="btn btn-primary"
        style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 999; border-radius: 40%; background-color: #8a6d3b; border-color: #8a6d3b;">
    <i class="fas fa-arrow-up"></i>
</button>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const backToTopBtn = document.getElementById("back-to-top");

        // Scroll eventini dinle
        window.addEventListener("scroll", function() {
            if (window.scrollY > 300) {
                backToTopBtn.style.display = "block"; // göster
            } else {
                backToTopBtn.style.display = "none";  // gizle
            }
        });

        // Butona tıklayınca yukarıya kaydır
        backToTopBtn.addEventListener("click", function() {
            window.scrollTo({ top: 0, behavior: "smooth" });
        });

        // Blog içeriğini set et
        const blogContent = document.getElementById("blog-content");
        if (blogContent) {
            blogContent.innerHTML = `{{ .Post.Content }}`;
        }

        // Alt yorumları göster/gizle butonları
        document.querySelectorAll('.toggle-replies-btn').forEach(btn => {
            if (btn) {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetDiv = document.getElementById(targetId);
                    if (!targetDiv) return;

                    if (targetDiv.style.display === 'none' || targetDiv.style.display === '') {
                        targetDiv.style.display = 'block';
                        this.textContent = this.textContent.replace('Göster', 'Gizle');
                    } else {
                        targetDiv.style.display = 'none';
                        this.textContent = this.textContent.replace('Gizle', 'Göster');
                    }
                });
            }
        });

        // Yorum formu elementlerini kontrol et
        const commentForm = document.getElementById('comment-form');
        if (commentForm) {
            const parentIdInput = document.getElementById('parent-id-input');
            const commentTextarea = document.getElementById('comment');
            const formTitle = document.getElementById('form-title');
            const cancelReplyBtn = document.getElementById('cancel-reply');

            // Yanıtla butonları
            document.querySelectorAll('.reply-btn').forEach(button => {
                if (button) {
                    button.addEventListener('click', function() {
                        const commentId = this.getAttribute('data-comment-id');
                        const replyTo = this.getAttribute('data-reply-to');

                        if (parentIdInput) parentIdInput.value = commentId;
                        if (commentTextarea) commentTextarea.placeholder = `@${replyTo} kullanıcısına yanıtınızı yazın...`;
                        if (formTitle) formTitle.textContent = `@${replyTo} kullanıcısına yanıt yazıyorsunuz`;
                        if (cancelReplyBtn) cancelReplyBtn.style.display = 'inline-block';

                        commentForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        if (commentTextarea) commentTextarea.focus();
                    });
                }
            });

            if (cancelReplyBtn) {
                cancelReplyBtn.addEventListener('click', function() {
                    if (parentIdInput) parentIdInput.value = '';
                    if (commentTextarea) {
                        commentTextarea.placeholder = 'Yorumunuzu yazın...';
                        commentTextarea.focus();
                    }
                    if (formTitle) formTitle.textContent = 'Yorum Yap';
                    cancelReplyBtn.style.display = 'none';
                });
            }
        }
    });

</script>
{{ end }}